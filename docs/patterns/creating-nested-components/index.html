<!DOCTYPE html>
<html>
    <head>
    <meta charset="UTF-8">

    

    <title>bow-arch: Creating nested components</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="bow-arch">
    <meta name="keywords" content="functional-programming, monads, monad-transformers, functional-data-structure, swift, bow, xcode, xcode-playgrounds, playgrounds, fp-types, adt, free-monads, tagless-final, mtl, for-comprehension, category-theory, architecture, mobile, apps, application, ios, macos">

    <meta property="og:image" content="/img/poster.png" />
    <meta property="og:title" content="bow-arch: Creating nested components" />
    <meta property="og:site_name" content="bow-arch: Creating nested components" />
    <meta property="og:url" content="https://arch.bow-swift.io/" />
    <meta property="og:type" content="website" />
    <meta property="og:description" content="bow-arch" />
    <meta property="og:keywords" content="functional-programming, monads, monad-transformers, functional-data-structure, swift, bow, xcode, xcode-playgrounds, playgrounds, fp-types, adt, free-monads, tagless-final, mtl, for-comprehension, category-theory, architecture, mobile, apps, application, ios, macos" />

    <meta name="twitter:text:description" content="bow-arch" />
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@bow_swift">
    <meta name="twitter:creator" content="@bow_swift">
    <meta name="twitter:image" content="/img/poster.png" />

    <meta property="github-info" data-github-owner="bow-swift" data-github-repo="bow-arch" />

    <script defer src="/js/docs.js"></script>

    <!-- Favicon -->
    <link rel="shortcut icon" href="/img/favicon.png">

    <!-- Docs css -->
    <link rel="stylesheet" type="text/css" href="/css/docs.css">
</head>

    <body>
        <div id="site-sidebar" class="site-sidebar">
  <div class="sidebar-brand">
    <a href="/" class="brand" title="Bow-arch">
      <img
        src="/img/bow-arch-brand.svg"
        alt="Bow-arch"
        class="brand-wrapper"
      />
      <span class="title-bold">Bow</span>
      <span>Arch</span>
    </a>
    <button
      id="main-toggle"
      type="button"
      title="Close"
      class="button sidebar-toggle"
    >
      <span class="close"></span>
    </button>
  </div>
  <div class="sidebar-menu">
    
      

      
      
      
      

      
      
      

      

      

    <div class="sidebar-menu-item  ">
       
      <button
        type="button"
        title="Open Quick start"
        class="button drop-nested"
      >
        Quick start
      </button>
      

      <div class="sub-menu">
        
        
        
        <a
          class=""
          href="/docs/quick-start/getting-started/"
          title="Getting started"
        >
          Getting started
        </a>
        
        
        
        <a
          class=""
          href="/docs/quick-start/resources/"
          title="Resources"
        >
          Resources
        </a>
        
      </div>
      
    </div>
    

      
      
      
      

      
      
      

      

      

    <div class="sidebar-menu-item  ">
       
      <button
        type="button"
        title="Open Background"
        class="button drop-nested"
      >
        Background
      </button>
      

      <div class="sub-menu">
        
        
        
        <a
          class=""
          href="/docs/background/overview/"
          title="Overview"
        >
          Overview
        </a>
        
        
        
        <a
          class=""
          href="/docs/background/monads-and-comonads/"
          title="Monads and Comonads"
        >
          Monads and Comonads
        </a>
        
        
        
        <a
          class=""
          href="/docs/background/pairings/"
          title="Pairings"
        >
          Pairings
        </a>
        
        
        
        <a
          class=""
          href="/docs/background/comonadic-uis/"
          title="Comonadic UIs"
        >
          Comonadic UIs
        </a>
        
      </div>
      
    </div>
    

      
      
      
      

      
      
      

      

      

    <div class="sidebar-menu-item  ">
       
      <button
        type="button"
        title="Open Core concepts"
        class="button drop-nested"
      >
        Core concepts
      </button>
      

      <div class="sub-menu">
        
        
        
        <a
          class=""
          href="/docs/core-concepts/state-and-input/"
          title="State and Input"
        >
          State and Input
        </a>
        
        
        
        <a
          class=""
          href="/docs/core-concepts/view/"
          title="View"
        >
          View
        </a>
        
        
        
        <a
          class=""
          href="/docs/core-concepts/dispatcher/"
          title="Dispatcher"
        >
          Dispatcher
        </a>
        
        
        
        <a
          class=""
          href="/docs/core-concepts/component/"
          title="Component"
        >
          Component
        </a>
        
      </div>
      
    </div>
    

      
      
      
      

      
      
      

      

      

    <div class="sidebar-menu-item active open">
       
      <button
        type="button"
        title="Open Patterns"
        class="button drop-nested"
      >
        Patterns
      </button>
      

      <div class="sub-menu">
        
        
        
        <a
          class=""
          href="/docs/patterns/creating-a-single-component/"
          title="Creating a single component"
        >
          Creating a single component
        </a>
        
        
        
        <a
          class="active"
          href="/docs/patterns/creating-nested-components/"
          title="Creating nested components"
        >
          Creating nested components
        </a>
        
      </div>
      
    </div>
    

      
      
      
      

      
      
      

      

      

    <div class="sidebar-menu-item  ">
       
      <button
        type="button"
        title="Open Legal"
        class="button drop-nested"
      >
        Legal
      </button>
      

      <div class="sub-menu">
        
        
        
        <a
          class=""
          href="/docs/legal/credits/"
          title="Credits"
        >
          Credits
        </a>
        
        
        
        <a
          class=""
          href="/docs/legal/license/"
          title="License"
        >
          License
        </a>
        
      </div>
      
    </div>
    
    
  </div>
</div>

        <main id="site-doc" class="site-doc">
    <div class="doc-header">
      <button
        id="menu-toggle"
        type="button"
        class="button doc-toggle"
        title="Toggle">
          <img src="/img/sidebar-icon-open.svg" alt="Toggle" title="Toggle">
      </button>

      <div class="link-container">
        <div class="link-item">
          <a href="https://github.com/bow-swift/bow-arch" title="GitHub repo" target="_blank" rel="noopener noreferrer">
            <span class="strong">GitHub</span>
            <span id="stars-count"></span>
          </a>
        </div>
      </div>

    </div>
    <div class="doc-content">
        <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">import</span> <span class="kt">SwiftUI</span>
<span class="kd">import</span> <span class="kt">Bow</span>
<span class="kd">import</span> <span class="kt">BowEffects</span>
<span class="kd">import</span> <span class="kt">BowOptics</span>
<span class="kd">import</span> <span class="kt">BowArch</span>
</code></pre></div></div>

<h1 id="creating-nested-components">Creating nested components</h1>

<p>Usually, you will need to create new components in terms of others with lower granularity. This page covers the most important aspects you need to consider when composing different components.</p>

<h2 id="creating-a-parent-view">Creating a parent view</h2>

<p>As components conform to <code class="highlighter-rouge">View</code>, nothing stops you from adding them to your SwiftUI views. Therefore, assuming you already have a <code class="highlighter-rouge">ChildComponent</code>, you can easily add it to your view hierarchy:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">struct</span> <span class="kt">ParentView</span><span class="p">:</span> <span class="kt">View</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">state</span><span class="p">:</span> <span class="kt">ParentState</span>
    <span class="k">let</span> <span class="nv">child</span><span class="p">:</span> <span class="kt">ChildComponent</span>
    
    <span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="kt">VStack</span> <span class="p">{</span>
            <span class="c1">// ... Some views ...</span>
            
            <span class="n">child</span>
            
            <span class="c1">// ... Some views ...</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>However, this forces to build the <code class="highlighter-rouge">ChildComponent</code> if, for instance, we would like to create a preview of <code class="highlighter-rouge">ParentView</code>. An alternative way of doing this is by parameterizing the <code class="highlighter-rouge">ParentView</code>:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">struct</span> <span class="kt">ParentView</span><span class="o">&lt;</span><span class="kt">Child</span><span class="p">:</span> <span class="kt">View</span><span class="o">&gt;</span><span class="p">:</span> <span class="kt">View</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">state</span><span class="p">:</span> <span class="kt">ParentState</span>
    <span class="k">let</span> <span class="nv">child</span><span class="p">:</span> <span class="kt">Child</span>
    
    <span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="kt">VStack</span> <span class="p">{</span>
            <span class="c1">// ... Some views ...</span>
            
            <span class="n">child</span>
            
            <span class="c1">// ... Some views ...</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>With this small change, we can now pass the ChildComponent, or any other stub view that we want in order to render the preview.</p>

<p>One additional step we can take is to pass a function that, given the child state, builds the corresponding component. This is particularly useful when we are dealing with collections of items.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">struct</span> <span class="kt">ParentView</span><span class="o">&lt;</span><span class="kt">Child</span><span class="p">:</span> <span class="kt">View</span><span class="o">&gt;</span><span class="p">:</span> <span class="kt">View</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">state</span><span class="p">:</span> <span class="kt">ParentState</span>
    <span class="k">let</span> <span class="nv">child</span><span class="p">:</span> <span class="p">(</span><span class="kt">ChildState</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Child</span>
    <span class="k">let</span> <span class="nv">handle</span><span class="p">:</span> <span class="p">(</span><span class="kt">ParentInput</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Void</span>
    
    <span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="kt">VStack</span> <span class="p">{</span>
            <span class="c1">// ... Some views ...</span>
            
            <span class="nf">child</span><span class="p">(</span><span class="k">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">childState</span><span class="p">)</span>
            
            <span class="c1">// ... Some views ...</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="creating-a-global-dispatcher">Creating a global dispatcher</h2>

<p>Next, both child and parent will have their own Dispatchers to interpret view inputs into state mutations. Those Dispatchers need to be combined into a single one. However, types of both dispatchers do not match:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">typealias</span> <span class="kt">ChildDispatcher</span> <span class="o">=</span> <span class="kt">StateDispatcher</span><span class="o">&lt;</span><span class="kt">ChildDependencies</span><span class="p">,</span> <span class="kt">ChildState</span><span class="p">,</span> <span class="kt">ChildInput</span><span class="o">&gt;</span>

<span class="kd">typealias</span> <span class="kt">ParentDispatcher</span> <span class="o">=</span> <span class="kt">StateDispatcher</span><span class="o">&lt;</span><span class="kt">ParentDependencies</span><span class="p">,</span> <span class="kt">ParentState</span><span class="p">,</span> <span class="kt">ParentInput</span><span class="o">&gt;</span>
</code></pre></div></div>

<p>In order to combine them, first we need to match their type signatures. As the <code class="highlighter-rouge">ChildDependencies</code>, <code class="highlighter-rouge">ChildState</code> and <code class="highlighter-rouge">ChildInput</code> are embedded into <code class="highlighter-rouge">ParentDependencies</code>, <code class="highlighter-rouge">ParentState</code> and <code class="highlighter-rouge">ParentInput</code> respectively, we can <code class="highlighter-rouge">widen</code> the <code class="highlighter-rouge">ChildDispatcher</code> to embed each parameter into its corresponding slot in the parent:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="nv">widenChildDispatcher</span><span class="p">:</span> <span class="kt">ParentDispatcher</span> <span class="o">=</span>
    <span class="n">childDispatcher</span><span class="o">.</span><span class="nf">widen</span><span class="p">(</span>
        <span class="nv">transformEnvironment</span><span class="p">:</span> <span class="p">\</span><span class="o">.</span><span class="n">childDependencies</span><span class="p">,</span>
        <span class="nv">transformState</span><span class="p">:</span> <span class="kt">ParentState</span><span class="o">.</span><span class="n">childLens</span><span class="p">,</span>
        <span class="nv">transformInput</span><span class="p">:</span> <span class="kt">ParentInput</span><span class="o">.</span><span class="nf">prism</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="kt">ParentInput</span><span class="o">.</span><span class="n">childInput</span><span class="p">))</span>

<span class="k">let</span> <span class="nv">combinedDispatcher</span> <span class="o">=</span> <span class="n">parentDispatcher</span><span class="o">.</span><span class="nf">combine</span><span class="p">(</span><span class="n">widenChildDispatcher</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="assembling-the-parent-component">Assembling the parent component</h2>

<p>Finally, when you create the parent component, you will need to forward the inputs that happen on the child component to the parent component, as some of these inputs may be relevant to other components that are upstream in the view hierarchy.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">func</span> <span class="nf">parentComponent</span><span class="p">(</span>
    <span class="nv">initialState</span><span class="p">:</span> <span class="kt">ParentState</span><span class="p">,</span>
    <span class="nv">dependencies</span><span class="p">:</span> <span class="kt">ParentDependencies</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">ParentComponent</span> <span class="p">{</span>
    <span class="kt">ParentComponent</span><span class="p">(</span>
        <span class="nv">initialState</span><span class="p">:</span> <span class="n">initialState</span><span class="p">,</span>
        <span class="nv">environment</span><span class="p">:</span> <span class="n">dependencies</span><span class="p">,</span>
        <span class="nv">dispatcher</span><span class="p">:</span> <span class="n">combinedDispatcher</span><span class="p">,</span>
        <span class="nv">render</span><span class="p">:</span> <span class="p">{</span> <span class="n">state</span><span class="p">,</span> <span class="n">handle</span> <span class="k">in</span>
            <span class="kt">ParentView</span><span class="p">(</span>
                <span class="nv">state</span><span class="p">:</span> <span class="n">state</span><span class="p">,</span>
                <span class="nv">child</span><span class="p">:</span> <span class="p">{</span> <span class="n">childState</span> <span class="k">in</span>
                    <span class="nf">childComponent</span><span class="p">(</span><span class="n">childState</span><span class="p">)</span>
                        <span class="o">.</span><span class="nf">using</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span>
                               <span class="nv">transformInput</span><span class="p">:</span> <span class="kt">ParentInput</span><span class="o">.</span><span class="nf">prism</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="kt">ParentInput</span><span class="o">.</span><span class="n">childInput</span><span class="p">))</span>
                <span class="p">},</span>
                <span class="nv">handle</span><span class="p">:</span> <span class="n">handle</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

    </div>
</main>

    </body>
</html>
